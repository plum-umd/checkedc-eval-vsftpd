# Checked C vsftpd

This directory contains the source code for
[vsftpd](https://security.appspot.com/vsftpd.html) version 3.0.3,
slightly modified so that it will build (but not actually work) on a
Mac.

It also contains some scripts, `convert_all.sh` and `replace.py`, that
can be used to help port this program to Checked C.

## Converting vsftpd

The file `convert_all.sh` was generated by the `conv_project.py`
tool. It contains the command line for calling the Checked C
conversion too, `CConvertStandalone`. To run this script, you must
edit it first to change the paths:

* Update `CCONV` to contain the path of the `CConvertStandalone` executable
* Update `INCLUDES` to contain the path of the `include` directory containing the [Checked C versions of the standard C headers](https://github.com/microsoft/checkedc/tree/master/include). 
* You might also wish to change the command-line flags to `CConvertStandalone`
+ Update `replace.py` and `update_database.py` to ensure the #!'s point to your python interpreter
+ Run `update_database.py`, this will change the entries in `compile_commands.json` to point to the correct directory

## Updating the files, running the compiler

At the conclusion of running this script, the `.h` headers and `.c`
source files will have versions with the output suffix `.checked`;
e.g., `str.c` will be output as `str.checked.c`.

You can overwrite the original files by running the script
`replace.py`. Having done this you can do the following.

### Diffing

Use `git diff` to compare the updated files with the originals. This
way you can see what definitions and variables have changed.

### Compiling

To compile the converted program, type `make CC=`*<path to checked C's
clang>*. You can additionally pass the `-i` flag to tell `make` to
keep going even if some files don't compile. 

### Reverting

If you don't want to keep the changes of the port, revert them by
calling `git reset --hard HEAD`.
